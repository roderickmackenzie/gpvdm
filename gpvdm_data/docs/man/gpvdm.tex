%\documentclass[10pt,twocolumn]{article}
\documentclass[11pt]{article}

\usepackage{graphicx}% Include figure files
\usepackage{setspace}
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{bm}% bold math
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{caption}
\usepackage{listings}
\usepackage{float}
\providecommand{\e}[1]{\ensuremath{\times 10^{#1}}}

\linespread{1.0}

\begin{document}

\title{Gpvdm user manual}

\author{Roderick C. I. MacKenzie}


\maketitle




\centerline{roderick.mackenzie@nottingham.ac.uk}


\begin{figure}[ht!]
\centering
\includegraphics[width=30mm]{./images/cell.jpg}
\label{overflow}
\end{figure}

\newpage
\section{Foreword}
This manual is a work in progress, as people ask questions to do with gpvdm, I write the answer in the manual and then send the link to them.  So the text is far from exhaustive.  If something is not clear, just drop me an e-mail.  I also suggest you also read the papers which were published from this model - do also read the supplementary information (SI) to the papers, as I often write about the model in there.

\newpage

\section{Running the model}

\subsection{Installing gpvdm for windows}
Go to the download page for gpvdm at \url{http://www.gpvdm.com/windows.php} and download the latest version.  Simply double click on it and say yes to all questions.  The installer may offer you a choice of where to install the software to, don't change the install destination, the current version will only work if it is in the default install path which is C:$\backslash$gpvdm.  I publish a new exe with updates every couple of weeks, however it is possible I won't actually use gpvdm for a while after having published a new version.  Therefore, it is entirely possible that I may have introduced bugs that break the code in between releases.  So, if gpvdm is not working for, you drop me an e-mail and I will do my best to fix it asap.

\input{linux.tex}

\section{Running gpvdm}
On both windows and linux gpvdm will install on the start menu, click on it to launch it.  Once run, a window resembling that in figure \ref{fig:mainwindow} will appear.  From the left, the first three icons on the toolbar, open a simulation, save a simulation and generate a new simulation.  Once you have made a new simulation, the the play button will run it, and the stop button will stop the simulation running.  You will find more video examples describing how to use the model throughout the gpvdm web page.

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{./images/main_window.png}
\caption{The main window, with a picture of the device on the right and the layer editor on the left.}
\label{fig:mainwindow}
\end{figure}


\input{electrical.tex}

\subsection{Meshing}
\subsubsection{Editing the electrical mesh/layers}
The device structure is split up into layers of different materials.  These can be configured in layer editor.  Some of these layers will have the layer type 'active'.  An 'active' layer is a layer over which the electrical model will be applied.  The electrical model needs a finite difference mesh to to be setup for it to work.  Usually, this will be take care of automatically, by gpvdm.  However, some users will want fine control over the mesh.  The electrical mesh editor is depicted in figure \ref{fig:emesh}.


The buttons marked 1D, 2D and 3D at the top of the window can be used to toggle the simulation between 1D, 2D and 3D modes.  (Note, if you want to do 2D or 3D simulations you are best off using a default 2D simulation, such as the OFET simulation.  This is because to do 2D/3D simulations, a special newton solver configuration will be needed.) The table on the left hand side is used to configure the mesh.  The sum of the mesh layer thicknesses must exactly match that of the sum of the active layers.  If this is not the case, the model will automatically rewrite the electrical mesh, to something that has the correct dimensions but may not be what the user desires.  Automatic mesh configuration can be turned off though the cog icon.  The columns thickness and mesh points, determine the thickness of the mesh layer and the number of points on the mesh layer, if there is a uniform spacing between mesh points.  The column, 'step multiply' by how much to grow each step.  In this example, the mesh spacing is increased by a factor of 0.1 each step.  The toggle button left/right, defines on which side the mesh layer is generated.  In this example there are two mesh layers, one starting on the left and one starting on the right.  The resulting mesh is plotted in the graph at the bottom of the window.  It can be seen that a non-linear mesh has been generated.

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{./images/emesh.png}
\caption{The electrical mesh editor}
\label{fig:emesh}
\end{figure}

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{./images/mesh.png}
\caption{A 1D diagram of the mesh}
\label{fig:emeshdiagram}
\end{figure}


\subsubsection{Editing the optical mesh/layers}
The optical mesh automatically extends to cover the optical simulation window, so one does not usually need to worry about configuring it.  The optical material layers are defined in the list at the bottom of figure \ref{fig:emesh}.  The first column is a unique identifier, it must start with a hash symbol, but apart from that you can call it what you want.  The second column is the thickness of the layer.  The forth column is the material system, data files describing the material system are stored in the 'phys' directory.  Finally, the forth column tells the model if the layer is part of the active layer or not (more about that in the next section.)

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{./images/opticalsimulation.png}
\caption{The electrical mesh editor}
\label{fig:opticalsimulation}
\end{figure}

\subsubsection{Interfacing the electrical and optical models}
In gpvdm there is both an electrical model and an optical model.  The optical simulation usually includes the glass substrate, the contacts and layers such as PEDOT:PSS.  The electrical simulation usually only covers the active layer of the device, thus a typically optical simulation is much bigger than the electrical simulation window.  The optical model feeds the calculated optical profile of the light into the electrical simulation.  You must therefore tell the optical model which layer in the optical simulation represents the active layer.  This is done by placing a 'yes' in the column 'Active layer' in figure \ref{fig:opticalsimulation}.
\newpage
\vfill

\subsubsection{The layer editor}
To set up and edit the vertical device structure, use the layer editor this is shown in figure \ref{fig:layer_editor}. Using this tool, you can add layers, remove layers, and move layers up and down.
\linebreak
\linebreak 
\textbf{The first column}: This is a human readable name for the layer.
\linebreak 
\linebreak 
\textbf{The second column}: The thickness of the layer in meters.
\linebreak
\linebreak 
\textbf{Third column}: Sets the optical material properties.
\linebreak
\linebreak 
\textbf{Forth column}: Sets how the model treats the layer.  The optical equations are solved over all layers.  However, if the layer is set as 'active layer', then gpvdm will the also solve the electrical equations over this layer.  More than one layer can be set as an active layer, in this case, the electrical equations will be solved over all, the layers marked 'active layer', this is useful when simulating heterojunctions.  A layer type 'other', means that the electrical equations will not be solved over that layer, but the optical equations will be.  A layer type contact, denotes that the layer represents a contact layer.  This is only affects/is needed for 2/3D simulations.


\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/layer_editor.png}
{\caption{The contact editor.}}
\label{fig:layer_editor}
\end{figure}

\subsubsection{The contact editor}

The contact editor is used to edit the contacts on the device, and what voltages are applied to which contacts, see figure \ref{fig:contact_editor}.  For a 1D simulation you can pretty much ignore this window.
\linebreak
\linebreak 
\textbf{The first column}: The human readable name for the contact.
\linebreak 
\linebreak 
\textbf{The second column}: Sets if the contact is at the top or bottom of the device.  There should be at least one contact at the top and one contact at the bottom of the device.  Some devices (OFETs) can have more than one contact at the top of the device. 
\linebreak
\linebreak 
\textbf{Third column}: This sets if the contact is 'active'.  In it's simplest form, an active contact is the contact to which the voltage ramp is applied during a JV curve simulation.  In a JV curve simulation, one contact will be held at 0 volts, while a steadily increasing voltage is applied to the other 'active' contact of the device.  If you are performing a transient voltage simulation, such as CELIV, the 'active' contact will have the CELIV voltage transient applied to it.  Swapping around the active contacts is equivalent to picking up the diode and turning it through 180 degrees and placing it back in the circuit.  This feature is most useful, when simulating OFETs, when one wants to apply a voltage ramp to one contact (i.e. the gate) out of three or four.
\linebreak
\linebreak 
\textbf{Forth column}: The start of the contact, not used in 1D simulations
\linebreak
\linebreak 
\textbf{Fifth column}: The width of the contact, not used in 1D simulations.
\linebreak
\linebreak
\textbf{Sixth column}: Sets the pasavation depth under the contact. Not used in 1D simulations.
\linebreak
\linebreak  
\textbf{Seventh column}: The sets the default voltage for a contact.  If the contact type is set as 'active', this value is ignored.  However, it the contact is not active, this voltage will appear on the contact.  This use useful in OFET simulations, where you want to hold a given contact at a set voltage. 
\linebreak
\linebreak  


\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/contact_editor.png}
{\caption{The contact editor.}}
\label{fig:contact_editor}
\end{figure}



\subsubsection{Scanning parameters}
Sometimes one wishes to systematically vary a simulation parameter, this is how to do it:




\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/1.jpg}
{\caption*{Step 1: Select the 'Parameter scan' tool.}}
\label{overflow}
\end{figure}


\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/2.jpg}
\caption*{Step 2: Add a 'scan line' to the scan.}
\end{figure}

\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/3.jpg}
\caption*{Step 3: Select the new 'scan line' and the click on the 'select parameter to change' tool.}
\label{overflow}
\end{figure}


\begin{figure}[ht!]
\centering
\includegraphics[width=40mm]{./images/4.jpg}
\caption*{Step 4: Select the parameter you want to change, click apply.}
\end{figure}


\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/5.jpg}
\caption*{Step 5: The 'scan line' should now be updated with the parameter you want to scan.}
\end{figure}


\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/6.jpg}
\caption*{Step 6: Now enter the parameters you wish to scan, in this case 0.0-0.5 suns.
Step 7: Click the run button.}
\end{figure}


\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/7.jpg}
\caption*{Step 8: Select the output file you want to plot.  gpvdm will plot all simulation results.}
\end{figure}

\subsubsection{1D, 2D and 3D simulations with gpvdm}
When deciding if you should perform 1D, 2D or 3D, simulations, consider the dimensionality of your problem.  For example if you consider a solar cell, it is only a few micros thick, and there is rapid variation in the structure, charge densities, mobilities, and doping as a function of depth (y).  However, the structure will not vary very quickly in the lateral (xz) plane.  Therefore, in general  to capture all interesting effects present within a solar cell one only needs a 1D model.  If one now considers OFETs, there is both vertical an lateral current flow, therefore one can not get away with a 1D model any more, as one must simulate both vertical current flow, and current between the source and the drain, thus one needs a 2D simulation.  As the number of dimensions increases, computation speed will decrease, therefore my general advice is to use the minimum number of dimensions possible to solve your problem.

\subsubsection{Why don't I get a 3D view of the device}
If your simulation window looks like figure \ref{fig:nothreed} and not like figure \ref{fig:threed}.  It means  either you do not have any 3D acceleration hardware on your computer, or you do not have the drivers for it installed.  If you have an ATI/Nvidia/Intel graphics card check that the drivers are installed.  Currently, not having working 3D hardware will not affect your ability to perform simulations.

\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/3d.jpg}
\caption{gpvdm with working 3D acceleration hardware.}
\label{fig:threed}
\end{figure}

\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{./images/no_3d.jpg}
\caption{gpvdm with no 3D acceleration hardware.}
\label{fig:nothreed}
\end{figure}

\vfill
\clearpage


\newpage

\section{Thermal models}
\subsection{Lattice thermal model}

\subsection{Energy balance - hydrodynamic transport model}
This is an experimental feature.  From the configure window one can access the thermal simulation tab \ref{fig:thermal}, by default this model is turned off.  There are three options, the lattice thermal model which just solves the lattice heat equation; electron thermal model and hole thermal model.  The latter two solve the energy balance equations, or 3rd order moment expansion of of the Boltzmann equation.  If you turn on just the lattice model, the lattice heat equation will be solved along with the electrical model.  The thermal solver is external to the electrical solver. 

\begin{equation}
 \frac{d}{dx}\Bigg(-  \kappa_{l} \frac{dT_{L}}{dt}\Bigg)=H
\end{equation}
where H (the heat source term) is given by

\begin{equation}
H=\frac{1}{q}\frac{dE_{c}}{dx} J_{n}+\frac{1}{q}\frac{dE_{v}}{dx} J_{p}+R(E_{c}-E_{v})
\end{equation}

If you turn on the electrical and hole thermal model, then the heat source term will be replaced by

\begin{equation}
H=\frac{3 k_{b}}{2} \Bigg ( n (\frac{T_{n}-T_{l}}{\tau_{e}}) + p (\frac{T_{p}-T_{l}}{\tau_{h}})\Bigg) +R(E_{c}-E_{v})
\end{equation}

and the energy transport equation for electrons

\begin{equation}
S_n=-\kappa_n \frac{dT_{n}}{dx}-\frac{5}{2} \frac{k_{b}T_{n}}{q} J_{n}
\end{equation}

and holes,

\begin{equation}
S_p=-\kappa_p \frac{dT_{p}}{dx}+\frac{5}{2} \frac{k_{b}T_{p}}{q} J_{p}
\end{equation}

will be solved.

The energy balance equations will also be solved for electrons,

\begin{equation}
\frac{dS_{n}}{dx}=\frac{1}{q}\frac{dE_{c}}{dx} J_{n}-\frac{3 k_{b}}{2} \Bigg( R T_{n}+ n(\frac{T_{n}-T_{l}}{\tau_{e}}) \Bigg)
\end{equation}

and for holes

\begin{equation}
\frac{dS_{p}}{dx}=\frac{1}{q}\frac{dE_{v}}{dx} J_{p}-\frac{3 k_{b}}{2} \Bigg( R T_{p}+ n(\frac{T_{p}-T_{l}}{\tau_{e}}) \Bigg)
\end{equation}

The thermal conductivity of the electron gas is given by

\begin{equation}
\kappa_{n}=\Bigg ( \frac{5}{2} +c_n\Bigg) \frac{{k_{b}}^2}{q} T_{n} \mu_n n
\end{equation}

and for holes as,

\begin{equation}
\kappa_{p}=\Bigg ( \frac{5}{2} +c_p\Bigg) \frac{{k_{b}}^2}{q} T_{p} \mu_p p
\end{equation}


\begin{figure}[!htb]
\centering
\includegraphics[width=100mm]{./images/thermal.jpg}
{\caption{The thermal configuration window}}
\label{fig:thermal}
\end{figure}


\newpage

\section{Optical models}
\subsection{Ray tracing model}
\subsection{FDTD - beta}
\subsection{Transfer matrix model}
The transfer matrix model is used for simulating external light incident on the device. 
On the left of the interface the electric field is given by
\begin{equation}
E_{1}=E^{+}_{1} e^{-j k_1 z}+E^{-}_{1} e^{j k_1 z}
\label{efield1}
\end{equation}
and on the right hand side of the interface the electric field is given by
\begin{equation}
E_{2}=E^{+}_{2} e^{-j k_2 z}+E^{-}_{2} e^{j k_2 z}
\label{efield2}
\end{equation}

Maxwel's equations give us the relationship between the electric and magnetic fields for a plane wave.

\begin{equation}
\nabla \times E=-j\omega \mu H 
\end{equation}
which simplifies to:
\begin{equation}
\frac{\partial E} {\partial z}=-j\omega \mu H 
\label{maxwel}
\end{equation}

Applying equation \ref{maxwel} to equations \ref{efield1}-\ref{efield2}, we can get the magnetic field on the left of the interface
\begin{equation}
-j \mu \omega H^{y}_{1}=-j k_1 E^{+}_{1} e^{-j k_1 z}+j k_1 E^{-}_{1} e^{j k_1 z}
\end{equation}
and on the right of the interface
\begin{equation}
-j \mu \omega H^{y}_{2}=-j k_2 E^{+}_{2} e^{-j k_2 z}+j k_2 E^{-}_{2} e^{j k_2 z}.
\end{equation}

Tidying up gives,
\begin{equation}
H^{y}_{1}=\frac{k}{\omega \mu}E^{+}_{1} e^{-j k_1 z}-\frac{k}{\omega \mu} E^{-}_{1} e^{j k_1 z}
\end{equation}

\begin{equation}
H^{y}_{2}=\frac{k}{\omega \mu}E^{+}_{2} e^{-j k_2 z}-\frac{k}{\omega \mu} E^{-}_{2} e^{j k_2 z}
\end{equation}


\subsubsection{Refractive index and absorption}
\begin{equation}
E(z,t)=Re(E_0 e^{j(-kz+\omega t)})= Re(E_0 e^{j(\frac{-2 \pi (n+j\kappa)}{\lambda}z + \omega t)})=e^{\frac{2\pi\kappa z}{\lambda}}Re(E_0 e^{\frac{j(-2 \pi (n+j\kappa)}{\lambda}z +\omega t})
\end{equation}
And because the intensity is proportional to the square of the electric field the absorption coefficient becomes

\begin{equation}
e^{-\alpha x}=e^{\frac{2\pi\kappa z}{\lambda}}
\end{equation}

\begin{equation}
\alpha=-\frac{4\pi\kappa}{\lambda_0}
\end{equation}

\subsubsection{Why has the efficency of my solar cell changed now that I have upgraded to gpvdm v 4.97+}
My self and my students have recently put a lot of effort into improving the materials data base.  This means improved, absorption and refractive index data, this can affect the calculate device efficiency.  If you want to reproduce a device efficiency from a previous version of gpvdm, go to Simulations->Optica Simulation->Optical setup->Photon Efficiency. And play with this value, until you can reproduce the old efficiency.  You should only have to change the value by 20\% or so.

\subsubsection{Is Langevin recombination a good way of describing recombination OPV devices?}
In my view Langevin recombination is in general a really bad way to describe recombination in OPV devices.  This is because the mechanism assumes Brownian motion of electrons and holes and that charge carriers of opposite polarity will recombine when they get close enough to fall into each others electrostatic field.  This picture assumes the charge carriers are free and completely neglects the influence of trap states.  I therefore think Langeving recombination should be avoided in OPVs.
But in dx.doi.org/10.1021/jp200234m you used Langevin recombination - why?: In this paper I allowed the mobility in the Langevin expression to vary as a function of carrier density i.e.
\begin{equation}
R_{free}=q k_{r}\frac{(\alpha \mu_e(n)+\beta \mu_h(n)) n_{tot} p_{tot}}{2\epsilon_0\epsilon_r}
\end{equation}

I then by defining a mobility edge and assuming any carrier below the mobility edge could not move and any carrier above it could.  I could define the averaged electron/hole mobility as: 

\begin{equation}
\mu_e(n)=\frac{\mu_e^0 n_{free}}{n_{free}+n_{trap}}
\end{equation}

and

\begin{equation}
\mu_h(n)=\frac{\mu_h^0 p_{free}}{p_{free}+p_{trap}}
\end{equation}

and if one assumes the density of free charge carriers is much smaller than the density of trapped charge carriers one can arrive at

\begin{equation}
R(n,p)=q k_{r}\frac{(\alpha \mu_e^0 n_{free} p_{trap}+\beta \mu_h p_{free} n_{trap}) }{2\epsilon_0\epsilon_r}
\end{equation}

Thus by making the mobility carrier density dependent we arrive at an expression for Langeving recombination that's dependent upon the density of free and trapped carriers (i.e. $n_{free} p_{trap}$ and $ p_{free} n_{trap}$) This is in principle the same as SRH recombination (i.e. a process involving free electrons (holes) recombining with trapped holes (electrons)).  This was a nice simple approach and it worked quite well in the steady state.  However, to make this all work I had to assume all electrons (holes) at any given position in space had a single quasi-Fermi level, which meant they were all in equilibrium with each other.  For this to be true, all electrons (holes) would have to be able to exchange energy with all other electrons (holes) at that position in space and have an infinite charge carrier thermalization velocity.  This seemed like an OK assumption in steady state when electrons (holes) had time to exchange energy, however once we start thinking about things happening in time domain, it becomes harder to justify because there are so many trap states in the device it is unlikely that charge carriers will be able to act as one equilibrated gas with one quasi-Fermi level.  On the other hand the SRH mechanism does not make this assumption, so it is probably a better description of recombination/trapping.  I would also add that I have never found a situation in OPV device modeling where SRH recombination was unable to describe the device in question.  Conclusion: SRH is better than Langevin.  


\subsubsection{Should I trust the results of gpvdm?}
Yes!  The model it's self has been verified against experiment [there are over 20 publications doing this, in steady state, time domain (us-fs time scales), and fx-domain]. The basic drift-diffusion solver was cross checked and compared against other drift diffusion models, and the accuracy compared down to 6-9 dp.  While the optical model has been compared to analytical solutions of Maxwell's equations.  The SRH model has also been compared against analytical models.  If the answers you are getting out of gpvdm are odd, then I would suggest to take a look at the input parameters.  If your efficienceis are high, try increasing the number of trap states, the recombination cross sections or reducing the e/h mobilites.  Finally, I would also recommend always running the latest version, and keeping an eye on the twitter stream for bug announcements.

\section{The materials database - optical parameters}
To calculate the photondensity within the device, the model must know the refractive index and absorption of each material layer.  There are two materials databases, a read only copy and a read and writable one.  When the model starts for the first time it copies the read only materials database from C:$\backslash$Program Files$\backslash$gpvdm$\backslash$materials, to the gpvdm\_local folder in your home directory.  If you delete the copy of the materials base in the gpvdm\_local folder it will get copied back next time you start the model.  The subdirectory within the materials database identifies the material name.  In each sub directory there are two key files $alpha.omat$ and $n.omat$, these files are standard text files can be opened with any text editor such as wordpad.    Alpha.omat contains the absorption coefficient of the material while n.omat contains the the refractive index.  The first column of the file contains the wavelength in $m$ (not $cm$ or $nm$), and the second column of the file contains the absorption coefficient in $m^{-1}$ (for alpha.omat) and the real part of the refractive index (i.e. n) in au (for n.omat).

\section{The materials database - electrical parameters}
In some materials files there are also electrical parameters defined in $dos.inp$ files. These files are only used to draw the band diagrams in the optical editor..  As soon as you set a layer to be electrically active, these files will be completely ignored for that layer, with the Eg/LUMO level coming then being taken from the electrical parameters tab within the simulation window.  The only exception to this is the file $materials/generic/default/dos.inp$ which is used as the default for all newly made electrical layers.  I often get asked why I do not provide more electrical parameters with the model, as I do for the optical parameters.  The reason for this is because the proprieties of most thin film layers in devices can change by many orders of magnitude depending on how the layer is deposited (and indeed in which lab it is deposited), if you want to know the electrical parameters from your device the best way to find this is by fitting your model to experimental data.

\subsection{Adding new materials - the hard way}
If you wish to add materials to the database which do not come as standard with the model you can do it in the following way:  Simply copy an existing material directory (say C:$\backslash$Program files$\backslash$gpvdm$\backslash$materials$\backslash$ito) to a new directory (say C:$\backslash$Program files$\backslash$gpvdm$\backslash$materials$\backslash$mynewmaterial).  Then replace alpha.omat and n.omat with your data for the new material. There are two other files in each sub directory, namely fit.inp and mat.inp.  The file fit.inp is needed can be ignored, the file mat.inp is defined as follows:
\newline
\newline
\begin{lstlisting}[language=matlab,frame=single]
#LUMO		The LUMO level of the material 
4.7
#Eg		The LUMO-HOMO level of the material
0.0
#Red		Color of material in GUI
0.4
#Green		Color of material in GUI
0.4
#Blue		Color of material in GUI
0.4
#material_type	Oxide,metal,organic or inorganic.
oxide
#status		Public or private material
public
#ver		The version of the file.
1.0
#end		Defines the end of the file.
\end{lstlisting}

If you don't have data to hand for your material, but you do have a paper containing the data, you use the program Engauge Digitizer, written by  Mark Mitchell \url{https://github.com/markummitchell/engauge-digitizer} to export data from publications.  After you have finished updating the new material directory, whenever a new simulation is generated the new material files will automatically be copied into the active simulation directory ready for use. 

\subsection{Adding new materials - the easy way}
There is a youtube video on the gpvdm you tube channel describing how to do this.

\section{Changing the model}
\subsection{Editing the source code}
You can download the source code from my git hub repository \url{https://github.com/roderickmackenzie/gpvdm}.  If you do add new features yourself, please do send me patches and I will do my best to include your improvements in the main source tree.  I plan to make the source more user friendly by adding doxgen type comments, but as of yet source code comments are few and far between simply because of lack of time on my part to document.  If you have questions send me questions and I will do my best to answer.

\subsection{The structure of the model}
The model is divided into two parts, the graphical interface (GUI) and the back end solver (see \ref{fig:structureofthemodel}).  The role of the GUI, is simply to edit the input files (sim.gpvdm) and view the results.  It is the back end solver which does all the computation.  The file C:$\backslash$gpvdm$\backslash$gpvdm.exe, contains the GUI, and is a python program using a QT widget set, compiled into a windows executable.  The file C:$\backslash$gpvdm$\backslash$gpvdm\_core.exe is the back end solver which is written in C.
\begin{figure}
\centering
\includegraphics[width=100mm]{./images/architecture.png}
\caption{The structure of the model}
\label{fig:structureofthemodel}
\end{figure}
If you want to run the model from the command line, make a new simulation using the GUI, then close the GUI, and open up the terminal window.  Navigate to the directory where you saved your simulation, then enter C:$\backslash$gpvdm$\backslash$gpvdm\_core.exe in the command line.  gpvdm should then run in the terminal.

\subsection{Structure of the optical model}
I have split the optical model up into different dynamically loadable modules to so that you can write your own optical modules without too much work.  In linux these are .so files and in windows they are .dll files, these are kept in the 'light' directory.  I've not documented the interface of the plugins but if you start looking at light\_interface.c it should be pretty clear.

\subsection{Structure of the electrical solver}
I've broken the electrical model up into various plugins again to make it easier to write extra modules.  They are dynamically loaded as they are needed.  The Newton solvers and matrix inverting libraries are also plugins so they can be swapped out.


\subsection{Running gpvdm on a cluster}
Gpvdm will run on a cluster, this can be handy when doing large numbers of simulations.  To do this you need to download the cluster management code from  \url{https://github.com/roderickmackenzie/simpleclustercode}.  The clustering code as it stands is pretty much undocumented, but it should be possible to get it going.  You will have to recompile gpvdm to run on the cluster though.

\subsection{Updates}
I suggest you check the webpage regularly for updates, as I often publish minor improvements/bug fixes.  Gpvdm does have a built in update system, when it starts it connects to  \url{http://www.gpvdm.com/download_windows/update.php?ver_core=4.44&os=WinVer}, where 4.44 is replaced by your version of gpvdm and WinVer is replaced by your version of windows.  If no updates are found gpvdm.com will transmit "noupdates" back to the software.  If updates are found, the url will return the text "update 4.45" (where 4.45 is replaced with the most current verstion).  The software will then show a dialog box to inform the user that there is an update available and which version it is.    I've put this feature in, so that if I find a major bug that affects the validity of simulation results, I can inform all users quickly.  The user will then have to go and download it manually to install it.  Currently, there is no option to automatically update the software. 

\subsection{Can I use the model to simulate my exotic* material system/contacts?}
The short answer is yes.  The model is an effective medium model, meaning that it does not simulate the details of the medium, rather it approximates the medium with a set of electrical parameters.  For example, when simulating an organic solar cell, it does not simulate every detail of the BHJ, rather it just assumes an effective mobility, density of states, recombination cross sections, trapping cross sections and so on...  So if you can find electrical parameters to aproximate your material system (or guess them), there is nothing stopping you using gpvdm to simulate any exotic device/material.  The same goes for the contacts, the model simulates the contacts simply as a charge density. So if you have fancy graphene contacts which inject lots of charge, use a high majority carrier density on the contacts.  Where as if you have some dirty old ITO contacts may be drop the majority carrier density a bit.

\newpage

\section{FDTD code}
FDTD code is a new addition to gpvdm.
\begin{equation}
\frac{\partial E}{\partial t}= \frac{1}{\epsilon} \nabla \times H - \frac{1}{\epsilon} (\sigma E) 
\end{equation}


\begin{equation}
\frac{\partial E_x}{\partial t}= \frac{1}{\epsilon}(\frac{\partial H_z}{\partial y}-\frac{\partial H_y}{\partial z}-\sigma E_x) 
\end{equation}

\begin{equation}
\frac{\partial E_y}{\partial t}= \frac{1}{\epsilon}(\frac{\partial H_x}{\partial z}-\frac{\partial H_z}{\partial x}-\sigma E_y) 
\end{equation}

\begin{equation}
\frac{\partial E_z}{\partial t}= \frac{1}{\epsilon}(\frac{\partial H_y}{\partial x}-\frac{\partial H_x}{\partial y}-\sigma E_z) 
\end{equation}

Removing the z dependence because we don't care about it.

\begin{equation}
\frac{\partial E_x}{\partial t}= \frac{1}{\epsilon}(\frac{\partial H_z}{\partial y}-\sigma E_x) 
\end{equation}

\begin{equation}
\frac{\partial E_y}{\partial t}= \frac{1}{\epsilon}(-\frac{\partial H_z}{\partial x}-\sigma E_y) 
\end{equation}

\begin{equation}
\frac{\partial E_z}{\partial t}= \frac{1}{\epsilon}(\frac{\partial H_y}{\partial x}-\frac{\partial H_x}{\partial y}-\sigma E_z) 
\end{equation}


\section{Output directories}
\textbf{equilibrium}\newline
Before the solver starts any simulation it solves the device equations in the dark with 0V applied bias.  The result of this calculation are placed in this directory.  The practical reason for doing this is that Newton's method only works if you give it a reasonable starting guess for any given problem.  Thus to start the solver, we guess the carrier densities at 0V in the dark, we then use Newton's method to calculate the exact carrier density profiles at 0V in the dark (results are stored in the equilibrium directory), then from this point we can work our way to other solutions say at +1V in the light.\cite{0953-8984-25-21-215301}
\newline

\section{Output files}
Writing to disk is slow on even the most modern of computers with an SSD.  The seek speed of mechanical disks has increased little of their history.  Thus often writing the output data to the hard disk is the most time consuming part of any simulation.  By default gpvdm writes all output files to disk.  If you want to speed up your simulation, you can only write the files you need to disk.  This can be done in a fine grained way through the configure window and clicking on the detailed dump control tab.  You will from there be able to turn on and off output files.

\begin{figure}
\centering
\includegraphics[width=100mm]{./images/output_files.png}
\caption{Selecting which output files are witten to disk.}
\end{figure}

\input{files}

\textbf{sim\_info.dat}\newline
This file contains quantities calculated from the simulation such as $V_{oc}$, $J_{sc}$ what is in the file depends on what type of simulation you whish to carry out.  The file is a JSON formatted file file some common tokens are defined below:

JV curve simulation:

\begin{center}
\begin{tabular}{ |c|c|c| c|} 
\hline
JSON token & Meaning & Units & Ref \\
\hline
ff & Fill factor&au&\\
pce & 			PCE& percent&\\
Pmax & 			Power at Pmax&&\\
voc & 			$V_{oc}$ &&\\
voc\textunderscore R & 		Recombination rate at $P_{max}$& &\\
jv\textunderscore voc \textunderscore k & 		&&\\
jv\textunderscore pmax \textunderscore n & 	&&\\
voc\textunderscore nt & Trapped electron carrier densiyt at $V_oc$		&&\\
voc\textunderscore pt & Trapped hole carrier density at $V_oc$		&&\\
voc\textunderscore nf & Free electron carrier densiyt at $V_oc$		&&\\
voc\textunderscore pf & Free hole carrier density at $V_oc$		&&\\
jsc 				  & 	$J_{sc}$		& $Am^{-2}$&\\
jv\textunderscore jsc \textunderscore n & Average charge density at $J_{sc}$	& $m^{-3}$&\\
jv\textunderscore vbi & Built in voltage		& V&\\
jv\textunderscore gen & Average generation rate		&&\\
voc\textunderscore np \textunderscore tot & 	&&\\
j\textunderscore pmax & Current at $P_{max}$		& $Am^{-2}$&\\
v\textunderscore pmax & Voltage at $P_{max}$    & V &\\
mu\textunderscore jsc & 		&$m^{2} V^{-1} s^{-1}$&\\
mu\textunderscore pmax & 		&$m^{2} V^{-1} s^{-1}$&\\
mu\textunderscore voc & 	Average mobility at $V_{oc}$	& $m^{2} V^{-1} s^{-1}$&\\
mue\textunderscore pmax & Average electron mobility at $P_{max}$	&$m^{2} V^{-1} s^{-1}$&\\
muh\textunderscore pmax & Average hole mobility at $P_{max}$ &$m^{2} V^{-1} s^{-1}$&\\
tau\textunderscore voc & 	Recombination time constant at $V_{oc}$	 & s &\\
tau\textunderscore pmax & 	Recombination time constant at $P_{max}$	&s&\\

theta\textunderscore srh\textunderscore free & $\theta_{SRH}$ Collection coefficient at $P_{max}$ y & au &p.100 5.2a\cite{Summon-FETCH-bonn_catalog_45326403},\cite{PhysRevApplied.6.024001}\\
theta\textunderscore srh\textunderscore free\textunderscore trap & $\theta_{SRH}$ Collection coefficient at $P_{max}$ & au &p.100 5.2a\cite{Summon-FETCH-bonn_catalog_45326403},\cite{PhysRevApplied.6.024001}\\

\hline
\end{tabular}
\end{center}

Optical simulation

\begin{center}
\begin{tabular}{ |c|c|c| c|} 
\hline
JSON token & Meaning & Units & Ref \\
\hline
J\textunderscore photo & Photo current density $Am^{-2}$& &\\
I\textunderscore photo & Photo current $A$& &\\


\hline
\end{tabular}
\end{center}

\section{Copyright of the manual}
This manual is released under CC-BY license.

\bibliographystyle{gpvdm.bst}
\bibliography{gpvdm}



\end{document}

